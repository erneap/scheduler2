<mat-vertical-stepper #stepper>
  <mat-step [stepControl]="selectionForm" errorMessage="Leave Request must be selected">
    <form [formGroup]="selectionForm">
      <ng-template matStepLabel>Choose Leave Request</ng-template>
      <mat-form-field appearance="fill" style="width: 30rem;">
        <mat-select formControlName="leaverequest" required
          (selectionChange)="setCurrent();stepper.next()">
          <mat-option value="0">Create New Request</mat-option>
          <mat-option *ngFor="let req of requests" [value]="req.id">
            {{getRequestLabel(req)}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div>
        <button mat-raised-button matStepperNext>Next</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="editorForm" errorMessage="Leave request incomplete">
    <ng-template matStepLabel>Create/Edit Request</ng-template>
    <div class="flexlayout row left" style="gap: 25px;">
      <form [formGroup]="editorForm">
        <div class="flexlayout row left" style="gap: 5px;">
          <div class="formFieldWide">
          <mat-form-field class="fieldWidthWide">
              <mat-label>Request Dates</mat-label>
              <mat-date-range-input
                [rangePicker]="picker">
                <input matStartDate placeholder="Start Date"
                  formControlName="start" (dateChange)="processChange('start')">
                <input matEndDate placeholder="End Date"
                  formControlName="end" (dateChange)="processChange('end')">
              </mat-date-range-input>
              <mat-hint>Include Time Off</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </div>
          <div class="formFieldWide">
            <mat-form-field class="fieldWidthWide">
              <mat-label>Primary Leave Code</mat-label>
              <mat-select formControlName="primarycode"
                (selectionChange)="processChange('code')">
                <mat-option *ngFor="let wc of workcodes" [value]="wc.id">
                  {{wc.title}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div> 
        </div>
        <div>
          <button mat-raised-button matStepperPrevious>Back</button>
          <button mat-raised-button matStepperNext 
            (click)="processNewRequest()">Next</button>
          <button mat-raised-button color="warn"
            (click)="deleteRequest()"
            *ngIf="selected.id !== '' && !approver">
            Delete
          </button>
          <button mat-raised-button (click)="stepper.reset()" *ngIf="selected.id === ''">
            Start Over
          </button>
        </div>
      </form>
      <div class="flexlayout column center">
        <div class="flexlayout row center">
          <div class="label">Created On:</div>
          <div class="label">{{getCurrentLeaveRequestDate()}}</div>
        </div>
        <div class="flexlayout row center">
          <div class="label">Current Status:</div>
          <div class="label">{{selected.status.toUpperCase()}}</div>
        </div>
        <div class="flexlayout row center">
          <div class="label">Approved By:</div>
          <div class="label">{{getApprovedBy()}}</div>
        </div>
        <div class="flexlayout row center">
          <div class="label">Approval Date:</div>
          <div class="label">{{getApprovedDate()}}</div>
        </div>
        <div class="flexlayout row center">
          <div class="label">PTO Hours</div>
          <div class="label">{{ptohours}}</div>
        </div>
        <div class="flexlayout row center">
          <div class="label">Holiday Hours</div>
          <div class="label">{{holidayhours}}</div>
        </div>
      </div>
    </div>
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>Leave Request Calendar</ng-template>
    <app-employee-leave-request-calendar-desktop [startdate]="selected.startdate"
      [enddate]="selected.enddate" [leaveCodes]="workcodes"
      [leavedays]="selected.requesteddays">
    </app-employee-leave-request-calendar-desktop>
    <div>
      <button mat-raised-button matStepperPrevious>Back</button>
      <button mat-raised-button matStepperNext
        *ngIf="selected.id !== ''">Next</button>
    </div>
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>Comments</ng-template>
    <div class="comments">
      <ng-container *ngIf="selected.comments.length === 0">
        <div>No Comments</div>
      </ng-container>
      <ng-container *ngIf="selected.comments.length > 0">
        <div *ngFor="let cmt of selected.comments">
          <div>{{cmt.getDate()}} - {{cmt.comment}}</div>
        </div>
      </ng-container>
    </div>
    <div>
      <button mat-raised-button matStepperPrevious>Back</button>
      <button mat-raised-button matStepperNext
        *ngIf="selected.id !== ''">Next</button>
    </div>
  </mat-step>
  <mat-step *ngIf="selected.status.toLowerCase() !== 'approved' && selected.id != ''">
    <ng-template matStepLabel>Submission/Approval</ng-template>
    <div>
      <button mat-raised-button matStepperPrevious>Back</button>
      <button mat-raised-button color="primary" 
        (click)="submitForApproval()"
        *ngIf="selected.status.toLowerCase() === 'draft' && selected.id !== ''">
        Submit For Approval
      </button>
      <button mat-raised-button color="accent" 
        (click)="approveLeaveRequest()"
        *ngIf="selected.status.toLowerCase() === 'requested' && approver">
        Approve
      </button>
      <button mat-raised-button color="accent" 
        (click)="unapproveLeaveRequest()"
        *ngIf="selected.status.toLowerCase() === 'requested' && approver">
        Unapprove
      </button>
      <button mat-raised-button matStepperNext *ngIf="approver">Next</button>
    </div>
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>Shift Coverage</ng-template>
    <app-employee-leave-request-availability-calendar-desktop
      [employee]="employee" [site]="site" [leavedays]="selected.requesteddays"
      [startdate]="selected.startdate" [enddate]="selected.enddate">
    </app-employee-leave-request-availability-calendar-desktop>
  </mat-step>
</mat-vertical-stepper>
